<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Management</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container-lg">
      <h1>User Management</h1>
      <button onclick="openCreateUserForm()">Create User</button>
      <div id="userList">
        <table>
          <thead>
            <tr>
              <th>Username</th>
              <th>Email</th>
              <th>Age</th>
              <th>Gender</th>
              <th>Address</th>
              <th>Phone Number</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="userTableBody">
            <!-- User data will be dynamically inserted here -->
          </tbody>
        </table>
      </div>
    </div>
    <div id="createUserModal" class="modal">
      <div class="modal-content">
        <form id="userForm">
          <input type="text" id="username" placeholder="Username" />
          <input type="email" id="email" placeholder="Email" />
          <input type="password" id="password" placeholder="Password" />
          <input type="number" id="age" placeholder="Age" />
          <input type="text" id="gender" placeholder="Gender" />
          <input type="text" id="address" placeholder="Address" />
          <input type="text" id="phoneNumber" placeholder="Phone Number" />
          <button type="button" onclick="saveUser()">Save</button>
        </form>
      </div>
    </div>
    <script src="script.js"></script>

    <script>
      // Function to save user
      async function saveUser() {
        try {
          // Get form input values
          const username = document.getElementById("username").value;
          const email = document.getElementById("email").value;
          const age = document.getElementById("age").value;
          const gender = document.getElementById("gender").value;
          const address = document.getElementById("address").value;
          const phoneNumber = document.getElementById("phoneNumber").value;
          const password = document.getElementById("password").value;

          // Create user object
          const newUser = {
            username,
            email,
            password,
            age,
            gender,
            address,
            phoneNumber,
          };

          // Send user data to the server
          const response = await fetch("http://localhost:3000/signup", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newUser),
          });

          // Check if user was successfully created
          if (response.ok) {
            // User created successfully, refresh user list
            fetchUsers();
            // Optionally, close the modal or clear the form inputs
          } else {
            // Failed to create user
            console.error("Failed to create user");
          }
        } catch (error) {
          console.error("Error saving user:", error);
        }
      }

      // Function to open the create user modal
      function openCreateUserForm() {
        document.getElementById("createUserModal").style.display = "block";
      }

      // Function to close the create user modal
      function closeCreateUserForm() {
        document.getElementById("createUserModal").style.display = "none";
      }
      // Function to fetch and display user data
      async function fetchUsers() {
        try {
          const response = await fetch("http://localhost:3000/users");
          const users = await response.json();
          const userTableBody = document.getElementById("userTableBody");
          userTableBody.innerHTML = "";
          users.forEach((user) => {
            const row = `
                        <tr>
                            <td>${user.username}</td>
                            <td>${user.email}</td>
                            <td>${user.age}</td>
                            <td>${user.gender}</td>
                            <td>${user.address}</td>
                            <td>${user.phoneNumber}</td>
                            <td>
                                <button onclick="editUser('${user._id}')">Edit</button>
                                <button onclick="deleteUser('${user._id}')">Delete</button>
                            </td>
                        </tr>
                    `;
            userTableBody.insertAdjacentHTML("beforeend", row);
          });
        } catch (error) {
          console.error("Error fetching users:", error);
        }
      }

      // Call fetchUsers function when the page finishes loading
      window.onload = fetchUsers;

      // Function to edit user
      async function editUser(userId) {
        try {
          console.log(`Edit user id function: ${userId}`);
          const response = await fetch(`http://localhost:3000/users/${userId}`);
          const userData = await response.json();

          // Populate form fields with user data for editing
          document.getElementById("username").value = userData.username;
          document.getElementById("email").value = userData.email;
          document.getElementById("age").value = userData.age;
          document.getElementById("gender").value = userData.gender;
          document.getElementById("address").value = userData.address;
          document.getElementById("phoneNumber").value = userData.phoneNumber;

          // Show a modal or form for editing the user data
          // For example, display a hidden form or open a modal here
        } catch (error) {
          console.error("Error editing user:", error);
        }
      }

      // Function to delete user
      async function deleteUser(userId) {
        try {
          const response = await fetch(`http://localhost:3000/users/${userId}`, {
            method: "DELETE",
          });

          if (response.ok) {
            // User deleted successfully
            console.log(`User with ID ${userId} deleted successfully`);
            // Optionally, you can refresh the user list or perform any other action
            // Call fetchUsers to referesh the data
            fetchUsers();
          } else {
            // Failed to delete user
            console.error(`Failed to delete user with ID ${userId}`);
          }
        } catch (error) {
          console.error("Error deleting user:", error);
        }
      }
    </script>
  </body>
</html>
